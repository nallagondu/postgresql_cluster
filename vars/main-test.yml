---
proxy_env: {}
cluster_vip: "10.20.6.4"
vip_interface: "{{ ansible_default_ipv4.interface }}"
patroni_cluster_name: "postgres-cluster"
patroni_install_version: "latest"
patroni_superuser_username: "postgres"
patroni_superuser_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  33626166386437613134363638386231386464383963303631613666363033663936316633323365
  3863373834373432666634383930316564303132633833320a343063343365643338383465613464
  66376337353865646433353731656135353364393632323032383136376636366630633337356232
  3934363032373839380a613365303135323639643031383038313530363562636633313139626465
  61326163306465643034313137393837626539393634666336653530613335636539373330356235
  6338313334383633323561656637376635393561313730336535
patroni_replication_username: "replicator"
patroni_replication_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  38386130653165653539323435373337366336613966393961376662616131656665303563363963
  3130323566623962623434636338353462626435316563370a636430303832643964333162613935
  31623131353336643561326366326634653463616437353633306362626164376162643235316631
  6266386263633563630a346231633039323964363765396130656639343137323161383462623366
  66376266396539636666636130316537323633356331313062353964663266663664353531663531
  6138383439613964353864666632636463326335633534653262
synchronous_mode: false
synchronous_mode_strict: false
synchronous_node_count: 1
with_haproxy_load_balancing: false
haproxy_listen_port:
  master: 5000
  replicas: 5001
  replicas_sync: 5002
  replicas_async: 5003
  stats: 7000
haproxy_maxconn:
  global: 100000
  master: 10000
  replica: 10000
haproxy_timeout:
  client: "60m"
  server: "60m"
vip_manager_version: "1.0.2"
vip_manager_conf: "/etc/patroni/vip-manager.yml"
vip_manager_interval: "1000"
vip_manager_iface: "{{ vip_interface }}"
vip_manager_ip: "{{ cluster_vip }}"
vip_manager_mask: "28"
dcs_exists: false
dcs_type: "etcd"
etcd_ver: "v3.3.27"
etcd_data_dir: "/var/lib/etcd"
etcd_cluster_name: "etcd-{{ patroni_cluster_name }}"
patroni_etcd_hosts: []
postgresql_version: "14"
postgresql_port: "5432"
postgresql_encoding: "UTF8"
postgresql_locale: "en_US.UTF-8"
postgresql_data_checksums: true
postgresql_password_encryption_algorithm: "scram-sha-256"
postgresql_users:
  - name: its_test
    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      39636535366438316436383039633235646430303231313663646639303536373261366336643930
      6333616333633062333733343462653634616635623436660a326665303562363135613235613630
      64663466633235326136663261393431386537353865616461613235353737626662616361306535
      6464313336653439620a333863356639366562333463653634303238646538656636636637323030
      30366637666530386562623963393633306561333034333762656133323231393364653139343335
      3565653139323734363334366231326230623662303137386363
    flags: "NOSUPERUSER"
  - name: its_metabase_test
    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      35393465623533326232346438613432333834666366383531336439306336623134663133353064
      6433643331356430356434316435616162366234333433350a373334303032633264333461663162
      38393730616633636537303735636134346531356637636332343162333138383165623136666137
      3731366265303065370a646631333763613931643066393665343764626161663738333338336439
      35623937386365623862623961346634613130336435653730363261663630393832333938353331
      3536623637366466636466373631313035616135353634663537
    flags: "NOSUPERUSER"
  - name: tms_test
    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      64306335616561343266326363663363363234393238393835306566386333383166623839663039
      3766666534623236643664643734623165333539313131650a323738353464373738363564393735
      61363337613035303066393833333966636661336433343861633836653562666236353438393337
      6466316430333739660a616536353938656262366235323838663239376535336262656134303664
      63303436323739386132343638383539316462363865313761613430303463666138383734366539
      3939636465383435633266356535653935613435373730653463
    flags: "NOSUPERUSER"
  - name: user_bek
    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      65343638353862353237636134623237326333383035613064346135393762386437386533343436
      6431333236626138316362623939643666633033363331310a353034303939323531396135663834
      30336236323039656636636433323937343933336566643563306533663438613931666333623335
      6535333366353239320a623837316161353833626236373230303530383233376366656165643031
      62323133383463616363366433333634376566353835336463633231376532623938653264373365
      6663656131346664643065656630643462366463316136646235
    flags: "NOSUPERUSER"
  - name: its_test_readonly
    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      32333561306538633730353332623933663131356664326635363030663736633437336463653462
      6339613038666331343735313061623263333038363264340a336565623937643464623533653565
      64333665323666346632363732356132313138313030376363613339653264363865393436636634
      6230383038376439650a373832356532343030653339663465616263326261353763616232633432
      32336264326365363333356338306465383837333732336566363731326139396634616465323766
      6531326233373262353636386233313436373765323363353266
    flags: "NOSUPERUSER"
  - name: supeoflex_sydtrafik_test
    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      61353335303039666439343463326334633066656533623833623634666239393232616364343435
      3037626130313465326464633162663739343339356636340a636134366632366434356231386664
      31336563616662643139393838643536623137393437306133393366353366623938386539306361
      6532343261303935300a303336643533386533303234373938656638613731643432356236376439
      63306134343939356535376232643830663637316137643531643966343437373134353937336539
      6132346433643163643331326262326337636633343764303566
    flags: "NOSUPERUSER"
  - name: vialis_fas_test
    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      32623731633931356136633533333236386630343362366431303035666530336138353232643465
      3766653032306232356130653933613437313062336435370a656363386232643632356439353739
      35666162363933366461396461626565653230313130613335663834343062626537636535366334
      3664646464616130330a376139356236313032356363646161386330343235383564343832383334
      30636665306139623436663963343530653065633735323065363632323937353033396234666664
      3732326665616232323562346532363134643332383765363039
    flags: "NOSUPERUSER"
postgresql_databases:
  - db: its_test
    owner: its_test
    encoding: "UTF8"
    lc_collate: "en_US.UTF-8"
    lc_ctype: "en_US.UTF-8"
  - db: its_metabase_test
    owner: its_metabase_test
    encoding: "UTF8"
    lc_collate: "en_US.UTF-8"
    lc_ctype: "en_US.UTF-8"
  - db: tms_test
    owner: tms_test
    encoding: "UTF8"
    lc_collate: "en_US.UTF-8"
    lc_ctype: "en_US.UTF-8"
  - db: supeoflex_sydtrafik_test
    owner: supeoflex_sydtrafik_test
    encoding: "UTF8"
    lc_collate: "en_US.UTF-8"
    lc_ctype: "en_US.UTF-8"
  - db: vialis_fas_test
    owner: vialis_fas_test
    encoding: "UTF8"
    lc_collate: "en_US.UTF-8"
    lc_ctype: "en_US.UTF-8"
postgresql_extensions: []
postgresql_parameters:
  - {option: "max_connections", value: "500"}
  - {option: "superuser_reserved_connections", value: "5"}
  - {option: "password_encryption", value: "{{ postgresql_password_encryption_algorithm }}"}
  - {option: "max_locks_per_transaction", value: "64"}
  - {option: "max_prepared_transactions", value: "0"}
  - {option: "huge_pages", value: "try"}
  - {option: "shared_buffers", value: "2GB"}
  - {option: "work_mem", value: "2097kB"}
  - {option: "maintenance_work_mem", value: "512MB"}
  - {option: "effective_cache_size", value: "6GB"}
  - {option: "checkpoint_timeout", value: "15min"}
  - {option: "checkpoint_completion_target", value: "0.9"}
  - {option: "min_wal_size", value: "1GB"}
  - {option: "max_wal_size", value: "4GB"}
  - {option: "wal_buffers", value: "16MB"}
  - {option: "default_statistics_target", value: "100"}
  - {option: "seq_page_cost", value: "1"}
  - {option: "random_page_cost", value: "1.1"}
  - {option: "effective_io_concurrency", value: "200"}
  - {option: "synchronous_commit", value: "on"}
  - {option: "autovacuum", value: "on"}
  - {option: "autovacuum_max_workers", value: "5"}
  - {option: "autovacuum_vacuum_scale_factor", value: "0.01"}
  - {option: "autovacuum_analyze_scale_factor", value: "0.01"}
  - {option: "autovacuum_vacuum_cost_limit", value: "500"}
  - {option: "autovacuum_vacuum_cost_delay", value: "2"}
  - {option: "autovacuum_naptime", value: "1s"}
  - {option: "max_files_per_process", value: "4096"}
  - {option: "archive_mode", value: "on"}
  - {option: "archive_timeout", value: "1800s"}
  - {option: "archive_command", value: "cd ."}
  - {option: "wal_level", value: "replica"}
  - {option: "wal_keep_size", value: "2GB"}
  - {option: "max_wal_senders", value: "10"}
  - {option: "max_replication_slots", value: "10"}
  - {option: "hot_standby", value: "on"}
  - {option: "wal_log_hints", value: "on"}
  - {option: "wal_compression", value: "on"}
  - {option: "shared_preload_libraries", value: "pg_stat_statements,auto_explain"}
  - {option: "pg_stat_statements.max", value: "10000"}
  - {option: "pg_stat_statements.track", value: "all"}
  - {option: "pg_stat_statements.track_utility", value: "false"}
  - {option: "pg_stat_statements.save", value: "true"}
  - {option: "auto_explain.log_min_duration", value: "10s"}
  - {option: "auto_explain.log_analyze", value: "true"}
  - {option: "auto_explain.log_buffers", value: "true"}
  - {option: "auto_explain.log_timing", value: "false"}
  - {option: "auto_explain.log_triggers", value: "true"}
  - {option: "auto_explain.log_verbose", value: "true"}
  - {option: "auto_explain.log_nested_statements", value: "true"}
  - {option: "track_io_timing", value: "on"}
  - {option: "log_lock_waits", value: "on"}
  - {option: "log_temp_files", value: "0"}
  - {option: "track_activities", value: "on"}
  - {option: "track_counts", value: "on"}
  - {option: "track_functions", value: "all"}
  - {option: "log_checkpoints", value: "on"}
  - {option: "logging_collector", value: "on"}
  - {option: "log_truncate_on_rotation", value: "on"}
  - {option: "log_rotation_age", value: "1d"}
  - {option: "log_rotation_size", value: "0"}
  - {option: "log_line_prefix", value: "'%t [%p-%l] %r %q%u@%d '"}
  - {option: "log_filename", value: "'postgresql-%a.log'"}
  - {option: "log_directory", value: "{{ postgresql_log_dir }}"}
  - {option: "hot_standby_feedback", value: "on"}
  - {option: "max_standby_streaming_delay", value: "30s"}
  - {option: "wal_receiver_status_interval", value: "10s"}
  - {option: "idle_in_transaction_session_timeout", value: "10min"}
  - {option: "jit", value: "off"}
  - {option: "max_worker_processes", value: "4"}
  - {option: "max_parallel_workers_per_gather", value: "2"}
  - {option: "max_parallel_workers", value: "4"}
  - {option: "max_parallel_maintenance_workers", value: "2"}
postgresql_pg_hba:
  - {type: "local", database: "all", user: "{{ patroni_superuser_username }}", address: "", method: "trust"}
  - {type: "local", database: "all", user: "all", address: "", method: "peer"}
  - {type: "host", database: "all", user: "all", address: "127.0.0.1/32", method: "{{ postgresql_password_encryption_algorithm }}"}
postgresql_pg_ident: []
pgbouncer_install: true
pgbouncer_conf_dir: "/etc/pgbouncer"
pgbouncer_log_dir: "/var/log/pgbouncer"
pgbouncer_listen_port: 6432
pgbouncer_max_client_conn: 10000
pgbouncer_max_db_connections: 1000
pgbouncer_default_pool_size: 20
pgbouncer_default_pool_mode: "session"
pgbouncer_admin_users: "postgres"
pgbouncer_stats_users: "postgres"
pgbouncer_generate_userlist: true
pgbouncer_auth_type: "{{ postgresql_password_encryption_algorithm }}"
pgbouncer_ignore_startup_parameters: "extra_float_digits,geqo"
pgbouncer_pools:
  - {name: "postgres", dbname: "postgres", pool_parameters: ""}
patroni_ttl: 30
patroni_loop_wait: 10
patroni_retry_timeout: 10
patroni_maximum_lag_on_failover: 1048576
patroni_master_start_timeout: 300
patroni_standby_cluster:
  host: ""
  port: "5432"
patroni_log_destination: stderr
patroni_log_dir: /var/log/patroni
patroni_log_level: info
patroni_log_traceback_level: error
patroni_log_format: "%(asctime)s %(levelname)s: %(message)s"
patroni_log_dateformat: ""
patroni_log_max_queue_size: 1000
patroni_log_file_num: 4
patroni_log_file_size: 25000000
patroni_log_loggers_patroni_postmaster: warning
patroni_log_loggers_urllib3: warning
patroni_postgresql_use_pg_rewind: true
patroni_remove_data_directory_on_rewind_failure: false
patroni_remove_data_directory_on_diverged_timelines: false
patroni_cluster_bootstrap_method: "initdb"
patroni_create_replica_methods:
  - basebackup
pgbackrest:
  - {option: "command", value: "/usr/bin/pgbackrest --stanza={{ pgbackrest_stanza }} --delta restore"}
  - {option: "keep_data", value: "True"}
  - {option: "no_params", value: "True"}
wal_g:
  - {option: "command", value: "wal-g backup-fetch {{ postgresql_data_dir }} LATEST"}
  - {option: "no_params", value: "True"}
basebackup:
  - {option: "max-rate", value: "100M"}
  - {option: "checkpoint", value: "fast"}
pg_probackup:
  - {option: "command", value: "pg_probackup-{{ pg_probackup_version }} restore -B {{ pg_probackup_dir }} --instance {{ pg_probackup_instance }} -j {{ pg_probackup_threads }} {{ pg_probackup_add_keys }}"}
  - {option: "no_params", value: "true"}
postgresql_restore_command: ""
pg_probackup_install: false
pg_probackup_install_from_postgrespro_repo: true
pg_probackup_version: "{{ postgresql_version }}"
pg_probackup_instance: "pg_probackup_instance_name"
pg_probackup_dir: "/mnt/backup_dir"
pg_probackup_threads: "4"
pg_probackup_add_keys: "--recovery-target=latest --skip-external-dirs --no-validate"
pg_probackup_patroni_cluster_bootstrap_command: "pg_probackup-{{ pg_probackup_version }} restore -B {{ pg_probackup_dir }} --instance {{ pg_probackup_instance }} -j {{ pg_probackup_threads }} {{ pg_probackup_add_keys }}"
wal_g_install: false
wal_g_ver: "v0.2.19"
wal_g_json:
  - {option: "AWS_ACCESS_KEY_ID", value: "minio"}
  - {option: "AWS_SECRET_ACCESS_KEY", value: "miniosecret"}
  - {option: "AWS_ENDPOINT", value: "http://172.26.9.200:9000"}
  - {option: "WALG_S3_PREFIX", value: "s3://bucket"}
  - {option: "AWS_S3_FORCE_PATH_STYLE", value: "true"}
  - {option: "WALG_COMPRESSION_METHOD", value: "brotli"}
  - {option: "PGDATA", value: "{{ postgresql_data_dir }}"}
  - {option: "PGHOST", value: "{{ postgresql_unix_socket_dir }}"}
wal_g_patroni_cluster_bootstrap_command: "wal-g backup-fetch {{ postgresql_data_dir }} LATEST"
pgbackrest_install: false
pgbackrest_install_from_pgdg_repo: true
pgbackrest_stanza: "stanza_name"
pgbackrest_repo_type: "posix"
pgbackrest_repo_host: "10.128.64.50"
pgbackrest_repo_user: "postgres"
pgbackrest_conf_file: "/etc/pgbackrest/pgbackrest.conf"
pgbackrest_conf:
  global:
    - {option: "log-level-file", value: "detail"}
    - {option: "log-path", value: "/var/log/pgbackrest"}
    - {option: "repo1-type", value: "{{ pgbackrest_repo_type |lower }}"}
    - {option: "repo1-host", value: "{{ pgbackrest_repo_host }}"}
    - {option: "repo1-host-user", value: "{{ pgbackrest_repo_user }}"}
  stanza:
    - {option: "pg1-path", value: "{{ postgresql_data_dir }}"}
    - {option: "process-max", value: "2"}
    - {option: "recovery-option", value: "recovery_target_action=promote"}
pgbackrest_patroni_cluster_restore_command:
  '/usr/bin/pgbackrest --stanza={{ pgbackrest_stanza }} --delta restore'
disable_archive_command: true
keep_patroni_dynamic_json: true
netdata_install: false
netdata_install_options: "--stable-channel --disable-telemetry --dont-wait"
netdata_conf:
  web_bind_to: "*"
  memory_mode: "dbengine"
  page_cache_size: 64
  dbengine_disk_space: 1024
